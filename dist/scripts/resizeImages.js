"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const bootstrap_1 = require("./bootstrap");
const Media_1 = require("../models/Media");
const fileType = require("file-type");
const sharp = require("sharp");
const Event_1 = require("../models/Event");
let mongoose;
const url = require('url');
const fs = require('fs-extra');
const path = require('path');
bootstrap_1.default().then((obj) => {
    mongoose = obj.mongoose;
    return start();
}).then(() => {
    console.log('done');
    return mongoose.connection.close();
}).catch(e => {
    console.error(e);
    if (mongoose.connection) {
        return mongoose.connection.close();
    }
}).then(() => {
    console.log('closed db conn');
});
const sizeTypeMap = {
    Optimized: {
        width: 1366,
    },
    Thumb: {
        width: 280,
        height: 440,
    },
};
async function start() {
    const events = await Event_1.default.find({});
    for (let i = 0; i < events.length; i++) {
        const rounds = events[i].Rounds;
        for (let j = 0; j < rounds.length; j++) {
            const contestants = rounds[j].Contestants;
            for (let k = 0; k < contestants.length; k++) {
                const contestant = contestants[k];
                const images = contestant.Images || [];
                for (let l = 0; l < images.length; l++) {
                    const image = images[l];
                    const compressedImagedId = image.Compressed.id;
                    const thumbnailImageId = image.Thumbnail.id;
                    const medias = await Promise.all([
                        Media_1.default.findById(compressedImagedId),
                        Media_1.default.findById(thumbnailImageId)
                    ]);
                    const modifiedMedias = await Promise.all([
                        optimizeMedia(medias[0]),
                        optimizeMedia(medias[1])
                    ]);
                    if (modifiedMedias[0]) {
                        image.Compressed.url = modifiedMedias[0].Url;
                    }
                    if (modifiedMedias[1]) {
                        image.Thumbnail.url = modifiedMedias[1].Url;
                    }
                }
            }
        }
        await events[i].save();
    }
}
async function optimizeMedia(media) {
    if (!media) {
        return;
    }
    const mediaUrl = media.Url;
    console.log(mediaUrl);
    const filePath = path.resolve(`${__dirname}/../public/${url.parse(mediaUrl).path}`);
    let imgBuffer;
    try {
        imgBuffer = await fs.readFile(filePath);
    }
    catch (e) {
        console.error('unable to find file', filePath);
    }
    if (imgBuffer) {
        const fType = fileType(imgBuffer);
        const width = sizeTypeMap[media.Type.toString()].width;
        const height = sizeTypeMap[media.Type.toString()].height;
        if (fType.ext === 'png') {
            const newFilePath = filePath.replace('png', 'jpg');
            // 108, 170 -> 150 x 236
            const result = await sharp(imgBuffer).rotate().resize(width, height).jpeg({
                quality: 50,
                chromaSubsampling: '4:4:4',
            }).toFile(newFilePath);
            media.Url = media.Url.replace('png', 'jpg');
            await media.save();
            await fs.unlink(filePath);
            console.log('changed file format', newFilePath, result);
            return media;
        }
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvYWRBcHAgZnJvbSAnLi9ib290c3RyYXAnO1xuaW1wb3J0IE1lZGlhTW9kZWwsIHsgTWVkaWFEb2N1bWVudCB9IGZyb20gJy4uL21vZGVscy9NZWRpYSc7XG5pbXBvcnQgZmlsZVR5cGUgPSByZXF1aXJlKCdmaWxlLXR5cGUnKTtcbmltcG9ydCAqIGFzIHNoYXJwIGZyb20gJ3NoYXJwJztcbmltcG9ydCBFdmVudE1vZGVsIGZyb20gJy4uL21vZGVscy9FdmVudCc7XG5sZXQgbW9uZ29vc2U6IHR5cGVvZiBpbXBvcnQoJ21vbmdvb3NlJyk7XG5jb25zdCB1cmwgPSByZXF1aXJlKCd1cmwnKTtcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMtZXh0cmEnKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5sb2FkQXBwKCkudGhlbigob2JqKSA9PiB7XG4gICAgbW9uZ29vc2UgPSBvYmoubW9uZ29vc2U7XG4gICAgcmV0dXJuIHN0YXJ0KCk7XG59KS50aGVuKCgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnZG9uZScpO1xuICAgIHJldHVybiBtb25nb29zZS5jb25uZWN0aW9uLmNsb3NlKCk7XG59KS5jYXRjaChlID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgIGlmIChtb25nb29zZS5jb25uZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBtb25nb29zZS5jb25uZWN0aW9uLmNsb3NlKCk7XG4gICAgfVxufSkudGhlbigoKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2Nsb3NlZCBkYiBjb25uJyk7XG59KTtcblxuY29uc3Qgc2l6ZVR5cGVNYXA6IHtba2V5OiBzdHJpbmddOiB7XG4gICAgICAgIHdpZHRoOiBudW1iZXI7XG4gICAgICAgIGhlaWdodD86IG51bWJlcjtcbiAgICB9fSA9IHtcbiAgICBPcHRpbWl6ZWQ6IHtcbiAgICAgICAgd2lkdGg6IDEzNjYsXG4gICAgICAgIC8vIGhlaWdodDogdW5kZWZpbmVkLCBhdXRvXG4gICAgfSxcbiAgICBUaHVtYjoge1xuICAgICAgICB3aWR0aDogMjgwLFxuICAgICAgICBoZWlnaHQ6IDQ0MCxcbiAgICB9LFxufTtcblxuYXN5bmMgZnVuY3Rpb24gc3RhcnQoKSB7XG4gICAgY29uc3QgZXZlbnRzID0gYXdhaXQgRXZlbnRNb2RlbC5maW5kKHt9KTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByb3VuZHMgPSBldmVudHNbaV0uUm91bmRzO1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHJvdW5kcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgY29uc3QgY29udGVzdGFudHMgPSByb3VuZHNbal0uQ29udGVzdGFudHM7XG4gICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGNvbnRlc3RhbnRzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVzdGFudCA9IGNvbnRlc3RhbnRzW2tdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlcyA9IGNvbnRlc3RhbnQuSW1hZ2VzIHx8IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsIDwgaW1hZ2VzLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlID0gaW1hZ2VzW2xdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21wcmVzc2VkSW1hZ2VkSWQgPSBpbWFnZS5Db21wcmVzc2VkLmlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0aHVtYm5haWxJbWFnZUlkID0gaW1hZ2UuVGh1bWJuYWlsLmlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtZWRpYXMgPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAgICAgICAgICAgICBNZWRpYU1vZGVsLmZpbmRCeUlkKGNvbXByZXNzZWRJbWFnZWRJZCksXG4gICAgICAgICAgICAgICAgICAgICAgICBNZWRpYU1vZGVsLmZpbmRCeUlkKHRodW1ibmFpbEltYWdlSWQpXG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGlmaWVkTWVkaWFzID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgICAgICAgICAgIG9wdGltaXplTWVkaWEobWVkaWFzWzBdKSxcbiAgICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZU1lZGlhKG1lZGlhc1sxXSlcbiAgICAgICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWRNZWRpYXNbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2UuQ29tcHJlc3NlZC51cmwgPSBtb2RpZmllZE1lZGlhc1swXS5Vcmw7XG4gICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAobW9kaWZpZWRNZWRpYXNbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlLlRodW1ibmFpbC51cmwgPSBtb2RpZmllZE1lZGlhc1sxXS5Vcmw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgZXZlbnRzW2ldLnNhdmUoKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG9wdGltaXplTWVkaWEobWVkaWE6IE1lZGlhRG9jdW1lbnQpIHtcbiAgICBpZiAoIW1lZGlhKSB7XG4gICAgICAgIHJldHVybiA7XG4gICAgfVxuICAgIGNvbnN0IG1lZGlhVXJsID0gbWVkaWEuVXJsO1xuICAgIGNvbnNvbGUubG9nKG1lZGlhVXJsKTtcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGgucmVzb2x2ZShgJHtfX2Rpcm5hbWV9Ly4uL3B1YmxpYy8ke3VybC5wYXJzZShtZWRpYVVybCkucGF0aH1gKTtcbiAgICBsZXQgaW1nQnVmZmVyO1xuICAgIHRyeSB7XG4gICAgICAgIGltZ0J1ZmZlciA9IGF3YWl0IGZzLnJlYWRGaWxlKGZpbGVQYXRoKTtcbiAgICB9ICBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCd1bmFibGUgdG8gZmluZCBmaWxlJywgZmlsZVBhdGgpO1xuICAgIH1cbiAgICBpZiAoaW1nQnVmZmVyKSB7XG4gICAgICAgIGNvbnN0IGZUeXBlID0gZmlsZVR5cGUoaW1nQnVmZmVyKTtcbiAgICAgICAgY29uc3Qgd2lkdGggPSBzaXplVHlwZU1hcFttZWRpYS5UeXBlLnRvU3RyaW5nKCldLndpZHRoO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSBzaXplVHlwZU1hcFttZWRpYS5UeXBlLnRvU3RyaW5nKCldLmhlaWdodDtcbiAgICAgICAgaWYgKGZUeXBlLmV4dCA9PT0gJ3BuZycpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0ZpbGVQYXRoID0gZmlsZVBhdGgucmVwbGFjZSgncG5nJywgJ2pwZycpO1xuICAgICAgICAgICAgLy8gMTA4LCAxNzAgLT4gMTUwIHggMjM2XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzaGFycChpbWdCdWZmZXIpLnJvdGF0ZSgpLnJlc2l6ZSh3aWR0aCwgaGVpZ2h0KS5qcGVnKHtcbiAgICAgICAgICAgICAgICBxdWFsaXR5OiA1MCxcbiAgICAgICAgICAgICAgICBjaHJvbWFTdWJzYW1wbGluZzogJzQ6NDo0JyxcbiAgICAgICAgICAgICAgICAvLyB0cmVsbGlzUXVhbnRpc2F0aW9uOiB0cnVlLFxuICAgICAgICAgICAgfSkudG9GaWxlKG5ld0ZpbGVQYXRoKTtcbiAgICAgICAgICAgIG1lZGlhLlVybCA9IG1lZGlhLlVybC5yZXBsYWNlKCdwbmcnLCAnanBnJyk7XG4gICAgICAgICAgICBhd2FpdCBtZWRpYS5zYXZlKCk7XG4gICAgICAgICAgICBhd2FpdCBmcy51bmxpbmsoZmlsZVBhdGgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NoYW5nZWQgZmlsZSBmb3JtYXQnLCBuZXdGaWxlUGF0aCwgcmVzdWx0KTtcbiAgICAgICAgICAgIHJldHVybiBtZWRpYTtcbiAgICAgICAgfVxuICAgIH1cbn0iXX0=
