"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const mongoose = require("mongoose");
const Preference_1 = require("./Preference");
const date_fns_timezone_1 = require("date-fns-timezone");
const RoundContestantSchema = new mongoose.Schema({
    Detail: { type: mongoose.Schema.Types.ObjectId, ref: 'Contestant' },
    Registration: { type: mongoose.Schema.Types.ObjectId, ref: 'Registration' },
    Enabled: Boolean,
    IsWinner: Number,
    EnableAuction: Number,
    EaselNumber: Number,
    VotesDetail: [{
            RegistrationId: String,
            VoteFactor: Number,
            PhoneNumber: String,
            VoteFactorInfo: {
                Type: String,
                Value: String
            },
            Hash: String
        }],
    Votes: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Registration' }],
    VoteByLink: Boolean,
    Images: [{
            'Original': {
                url: String,
                id: { type: mongoose.Schema.Types.ObjectId, ref: 'Media' }
            },
            'Thumbnail': {
                url: String,
                id: { type: mongoose.Schema.Types.ObjectId, ref: 'Media' }
            },
            'Compressed': {
                url: String,
                id: { type: mongoose.Schema.Types.ObjectId, ref: 'Media' }
            }
        }],
    Videos: [{
            'Original': {
                url: String,
                id: { type: mongoose.Schema.Types.ObjectId, ref: 'Media' }
            },
        }],
    Lot: { type: mongoose.Schema.Types.ObjectId, ref: 'Lot' }
});
const RoundSchema = new mongoose.Schema({
    RoundNumber: Number,
    Contestants: [RoundContestantSchema],
    IsFinished: { type: Boolean, default: false },
    VideoUrl: String
});
const RegistrationVoterSchema = new mongoose.Schema({
    RegistrationId: { type: mongoose.Schema.Types.ObjectId, ref: 'Registration' },
    VoteFactor: Number,
    PhoneNumber: String,
    VoteFactorInfo: {
        Type: String,
        Value: String
    },
    Hash: String,
    VoteUrl: String,
    Email: String,
    RegionCode: String,
    From: String,
    NickName: String,
    Preferences: [Preference_1.PreferenceSchema],
    Status: String,
    AuctionLink: String,
    AuctionUrl: String
});
const EventSchema = new mongoose.Schema({
    Name: { type: String, unique: true, index: true },
    EID: { type: String, unique: true, sparse: true, index: true },
    Description: { type: String },
    Contestants: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Contestant' }],
    Rounds: [RoundSchema],
    PhoneNumber: String,
    Registrations: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Registration' }],
    CurrentRound: RoundSchema,
    Enabled: { type: Boolean, index: true },
    RegistrationConfirmationMessage: String,
    Logs: [{
            Message: String,
            CreatedDate: Date
        }],
    RegistrationsVoteFactor: [RegistrationVoterSchema],
    VoteByLink: Boolean,
    SendLinkToGuests: Boolean,
    EmailRegistration: Boolean,
    Country: { type: mongoose.Schema.Types.ObjectId, ref: 'Country' },
    EventStartDateTime: { type: Date, index: true },
    EventEndDateTime: Date,
    TimeZone: { type: mongoose.Schema.Types.ObjectId, ref: 'Timezone' },
    TimeZoneOffset: String,
    TimeZoneICANN: String,
    TicketLink: String,
    Price: String,
    Venue: String,
    ShowInApp: { type: Boolean, index: true },
    Currency: { type: mongoose.Schema.Types.ObjectId, ref: 'Country' },
    ArtWidthHeight: String,
    AuctionDescription: String,
    AuctionStartBid: Number,
    MinBidIncrement: Number,
    AuctionNotice: String,
    EnableAuction: Boolean,
    Tax: Number,
    AdminControlInAuctionPage: Boolean,
    RegisterAtSMSVote: Boolean,
    SponsorLogo: { type: mongoose.Schema.Types.ObjectId, ref: 'Media' },
    SponsorText: String,
    SendAuctionLinkToGuests: Boolean,
    City: { type: mongoose.Schema.Types.ObjectId, ref: 'City' },
    SlackChannel: String,
    AuctionCloseStartsAt: Date,
    VideoStream: String,
    LiveStream: String,
    AuctionCloseRoundDelay: Number
}, { timestamps: true });
EventSchema.methods.hasVoted = function (phoneNumber, selectedRound) {
    const thisEvent = this;
    const checkVotedInRound = (round) => {
        for (let i = 0; i < round.Contestants.length; i++) {
            const contestant = round.Contestants[i];
            for (let j = 0; j < contestant.Votes.length; j++) {
                const voter = contestant.Votes[j];
                if (voter.PhoneNumber === phoneNumber || voter.Email === phoneNumber) {
                    return contestant;
                }
            }
        }
        return false;
    };
    if (selectedRound) {
        return checkVotedInRound(selectedRound);
    }
    else {
        return checkVotedInRound(thisEvent.CurrentRound);
    }
};
EventSchema.methods.edit = function (dto) {
    const thisEvent = this;
    const auctionStartTime = date_fns_timezone_1.parseFromTimeZone(dto.AuctionCloseStartsAt.toString(), 'M/D/Y HH:mm A', { timeZone: dto.TimeZoneICANN });
    dto.AuctionCloseStartsAt = auctionStartTime;
    thisEvent.Name = dto.Name;
    thisEvent.EID = dto.EID;
    thisEvent.Description = dto.Description;
    thisEvent.PhoneNumber = dto.PhoneNumber && dto.PhoneNumber.trim(); // phone number is optional
    thisEvent.Contestants = dto.Contestants;
    thisEvent.Country = dto.Country;
    thisEvent.EventStartDateTime = dto.EventStartDateTime;
    thisEvent.AuctionCloseStartsAt = dto.AuctionCloseStartsAt;
    thisEvent.EventEndDateTime = dto.EventEndDateTime;
    thisEvent.TimeZone = dto.TimeZone;
    thisEvent.TimeZoneOffset = dto.TimeZoneOffset;
    thisEvent.RegistrationConfirmationMessage = dto.RegistrationConfirmationMessage;
    thisEvent.Enabled = dto.Enabled;
    thisEvent.VoteByLink = dto.VoteByLink;
    thisEvent.SendLinkToGuests = dto.SendLinkToGuests;
    thisEvent.EmailRegistration = dto.EmailRegistration;
    thisEvent.TimeZoneICANN = dto.TimeZoneICANN;
    thisEvent.TicketLink = dto.TicketLink;
    thisEvent.Venue = dto.Venue;
    thisEvent.Price = dto.Price;
    thisEvent.ShowInApp = dto.ShowInApp;
    thisEvent.Currency = dto.Currency;
    thisEvent.ArtWidthHeight = dto.ArtWidthHeight;
    thisEvent.AuctionDescription = dto.AuctionDescription;
    thisEvent.AuctionStartBid = dto.AuctionStartBid;
    thisEvent.MinBidIncrement = dto.MinBidIncrement;
    thisEvent.AuctionNotice = dto.AuctionNotice;
    thisEvent.EnableAuction = dto.EnableAuction;
    thisEvent.AdminControlInAuctionPage = dto.AdminControlInAuctionPage;
    thisEvent.RegisterAtSMSVote = dto.RegisterAtSMSVote;
    thisEvent.Tax = dto.Tax;
    thisEvent.SendAuctionLinkToGuests = dto.SendAuctionLinkToGuests;
    thisEvent.SponsorText = dto.SponsorText;
    thisEvent.LiveStream = dto.LiveStream;
    thisEvent.VideoStream = dto.VideoStream;
    thisEvent.AuctionCloseRoundDelay = dto.AuctionCloseRoundDelay;
    if (dto.SponsorLogo) {
        thisEvent.SponsorLogo = dto.SponsorLogo;
    }
    thisEvent.City = dto.City;
    thisEvent.SlackChannel = dto.SlackChannel;
    const roundIds = dto.Rounds.map(r => r._id);
    thisEvent.Rounds = thisEvent.Rounds.filter(r => roundIds.contains(r.id));
    thisEvent.Rounds.forEach(r => {
        r.Contestants = updateRound(dto, r);
    });
    const currentRound = thisEvent.CurrentRound;
    if (currentRound) {
        currentRound.Contestants = updateRound(dto, currentRound);
    }
    const existingEventIds = thisEvent.Rounds.map(r => r.id);
    const newRounds = dto.Rounds.filter(rdto => !existingEventIds.contains(rdto._id));
    thisEvent.Rounds.addRange(newRounds);
};
function updateRound(dto, r) {
    const roundDto = dto.Rounds.find(x => x._id == r.id); // new
    // add video URL in round
    r.VideoUrl = roundDto.VideoUrl;
    const newContestantMap = {};
    const oldContestantMap = {};
    for (let i = 0; i < roundDto.Contestants.length; i++) {
        // iterate on new contestants
        newContestantMap[roundDto.Contestants[i].Detail._id.toString()] = roundDto.Contestants[i];
    }
    const toRemoveExistingIndexes = [];
    for (let j = 0; j < r.Contestants.length; j++) {
        // iterate on old contestant
        oldContestantMap[r.Contestants[j].Detail._id.toString()] = r.Contestants[j];
        const contestantDto = newContestantMap[r.Contestants[j].Detail._id.toString()];
        if (contestantDto) {
            // assign new easel number to existing
            r.Contestants[j].EaselNumber = contestantDto.EaselNumber;
            // assign new enable/disable status to existing
            r.Contestants[j].Enabled = contestantDto.Enabled;
            // assign Lot
            r.Contestants[j].Lot = contestantDto.Lot;
        }
        else {
            // these elements removed/replaced in new update
            toRemoveExistingIndexes.push(j);
        }
    }
    const toRemoveNewIndexes = [];
    for (let i = 0; i < roundDto.Contestants.length; i++) {
        // iterate on new contestants
        if (roundDto.Contestants[i].Detail.oldId && roundDto.Contestants[i].Detail.oldId.length > 0
            && oldContestantMap[roundDto.Contestants[i].Detail.oldId.toString()]) {
            const oldContestant = oldContestantMap[roundDto.Contestants[i].Detail.oldId.toString()];
            // copy data of old contestant here
            roundDto.Contestants[i].EaselNumber = oldContestant.EaselNumber;
            roundDto.Contestants[i].EnableAuction = oldContestant.EnableAuction;
            roundDto.Contestants[i].IsWinner = oldContestant.IsWinner;
            roundDto.Contestants[i].LastBidPrice = oldContestant.LastBidPrice;
            roundDto.Contestants[i].Votes = oldContestant.Votes;
            roundDto.Contestants[i].VotesDetail = oldContestant.VotesDetail;
            roundDto.Contestants[i].Images = oldContestant.Images;
            roundDto.Contestants[i].Videos = oldContestant.Videos;
            roundDto.Contestants[i].Lot = oldContestant.Lot;
            roundDto.Contestants[i].Registration = oldContestant.Registration;
        }
        if (oldContestantMap[roundDto.Contestants[i].Detail._id.toString()]) {
            // this contestant already exists in array, no need to add again
            toRemoveNewIndexes.push(i);
        }
    }
    // filter existing contestants
    r.Contestants = r.Contestants.filter((c, index) => { return toRemoveExistingIndexes.indexOf(index) === -1; });
    // filter new contestants
    const newContestants = roundDto.Contestants.filter((c, index) => { return toRemoveNewIndexes.indexOf(index) === -1; });
    // add new contestants
    r.Contestants.addRange(newContestants);
    return r.Contestants;
}
const EventModel = mongoose.model('Event', EventSchema);
exports.default = EventModel;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LCJmaWxlIjoibW9kZWxzL0V2ZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG5pbXBvcnQgRXZlbnREVE8gZnJvbSAnLi4vLi4vLi4vc2hhcmVkL0V2ZW50RFRPJztcbmltcG9ydCB7IFByZWZlcmVuY2VTY2hlbWEgfSBmcm9tICcuL1ByZWZlcmVuY2UnO1xuaW1wb3J0IFJvdW5kRFRPIGZyb20gJy4uLy4uLy4uL3NoYXJlZC9Sb3VuZERUTyc7XG5pbXBvcnQgUm91bmRDb250ZXN0YW50RFRPLCB7XG4gICAgQXJ0aXN0SW5kaXZpZHVhbEltYWdlLCBBcnRpc3RJbmRpdmlkdWFsVmlkZW8sXG4gICAgUmVnaXN0cmF0aW9uVm90ZUZhY3RvckRUT1xufSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvUm91bmRDb250ZXN0YW50RFRPJztcbmltcG9ydCBSZWdpc3RyYXRpb25EVE8gZnJvbSAnLi4vLi4vLi4vc2hhcmVkL1JlZ2lzdHJhdGlvbkRUTyc7XG5pbXBvcnQgTG90RFRPIGZyb20gJy4uLy4uLy4uL3NoYXJlZC9Mb3REVE8nO1xuaW1wb3J0IHsgQ29udGVzdGFudERUTyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9Db250ZXN0YW50RFRPJztcbmltcG9ydCB7IHBhcnNlRnJvbVRpbWVab25lIH0gZnJvbSAnZGF0ZS1mbnMtdGltZXpvbmUnO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnREb2N1bWVudCBleHRlbmRzIEV2ZW50RFRPLCBtb25nb29zZS5Eb2N1bWVudCB7XG4gICAgaGFzVm90ZWQocGhvbmVOdW1iZXI6IHN0cmluZywgcm91bmQ/OiBSb3VuZERUTyk6IGJvb2xlYW4gfCBSb3VuZENvbnRlc3RhbnREVE87XG4gICAgZWRpdChkdG86IEV2ZW50RFRPKTogdm9pZDtcbn1cblxuY29uc3QgUm91bmRDb250ZXN0YW50U2NoZW1hOiBtb25nb29zZS5TY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICBEZXRhaWw6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdDb250ZXN0YW50J30sXG4gICAgUmVnaXN0cmF0aW9uOiB7IHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiAnUmVnaXN0cmF0aW9uJyB9LFxuICAgIEVuYWJsZWQ6IEJvb2xlYW4sXG4gICAgSXNXaW5uZXI6IE51bWJlcixcbiAgICBFbmFibGVBdWN0aW9uOiBOdW1iZXIsXG4gICAgRWFzZWxOdW1iZXI6IE51bWJlcixcbiAgICBWb3Rlc0RldGFpbDogW3tcbiAgICAgICAgUmVnaXN0cmF0aW9uSWQ6IFN0cmluZyxcbiAgICAgICAgVm90ZUZhY3RvcjogTnVtYmVyLFxuICAgICAgICBQaG9uZU51bWJlcjogU3RyaW5nLFxuICAgICAgICBWb3RlRmFjdG9ySW5mbzoge1xuICAgICAgICAgICAgVHlwZTogU3RyaW5nLFxuICAgICAgICAgICAgVmFsdWU6IFN0cmluZ1xuICAgICAgICB9LFxuICAgICAgICBIYXNoOiBTdHJpbmdcbiAgICB9XSxcbiAgICBWb3RlczogW3sgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdSZWdpc3RyYXRpb24nfV0sXG4gICAgVm90ZUJ5TGluazogQm9vbGVhbixcbiAgICBJbWFnZXM6IFt7XG4gICAgICAgICdPcmlnaW5hbCc6IHtcbiAgICAgICAgICAgIHVybDogU3RyaW5nLFxuICAgICAgICAgICAgaWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdNZWRpYScgfVxuICAgICAgICB9LFxuICAgICAgICAnVGh1bWJuYWlsJzoge1xuICAgICAgICAgICAgdXJsOiBTdHJpbmcsXG4gICAgICAgICAgICBpZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ01lZGlhJyB9XG4gICAgICAgIH0sXG4gICAgICAgICdDb21wcmVzc2VkJzoge1xuICAgICAgICAgICAgdXJsOiBTdHJpbmcsXG4gICAgICAgICAgICBpZDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ01lZGlhJyB9XG4gICAgICAgIH1cbiAgICB9XSxcbiAgICBWaWRlb3M6IFt7XG4gICAgICAgICdPcmlnaW5hbCc6IHtcbiAgICAgICAgICAgIHVybDogU3RyaW5nLFxuICAgICAgICAgICAgaWQ6IHsgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdNZWRpYScgfVxuICAgICAgICB9LFxuICAgIH1dLFxuICAgIExvdDogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ0xvdCd9XG59KTtcblxuY29uc3QgUm91bmRTY2hlbWE6IG1vbmdvb3NlLlNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIFJvdW5kTnVtYmVyOiBOdW1iZXIsXG4gICAgQ29udGVzdGFudHM6IFtSb3VuZENvbnRlc3RhbnRTY2hlbWFdLFxuICAgIElzRmluaXNoZWQ6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogZmFsc2UgfSxcbiAgICBWaWRlb1VybDogU3RyaW5nXG59KTtcblxuY29uc3QgUmVnaXN0cmF0aW9uVm90ZXJTY2hlbWE6IG1vbmdvb3NlLlNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIFJlZ2lzdHJhdGlvbklkOiB7dHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLCByZWY6ICdSZWdpc3RyYXRpb24nIH0sXG4gICAgVm90ZUZhY3RvcjogTnVtYmVyLFxuICAgIFBob25lTnVtYmVyOiBTdHJpbmcsXG4gICAgVm90ZUZhY3RvckluZm86IHtcbiAgICAgICAgVHlwZTogU3RyaW5nLFxuICAgICAgICBWYWx1ZTogU3RyaW5nXG4gICAgfSxcbiAgICBIYXNoOiBTdHJpbmcsXG4gICAgVm90ZVVybDogU3RyaW5nLFxuICAgIEVtYWlsOiBTdHJpbmcsXG4gICAgUmVnaW9uQ29kZTogU3RyaW5nLFxuICAgIEZyb206IFN0cmluZyxcbiAgICBOaWNrTmFtZTogU3RyaW5nLFxuICAgIFByZWZlcmVuY2VzOiBbUHJlZmVyZW5jZVNjaGVtYV0sXG4gICAgU3RhdHVzOiBTdHJpbmcsXG4gICAgQXVjdGlvbkxpbms6IFN0cmluZyxcbiAgICBBdWN0aW9uVXJsOiBTdHJpbmdcbn0pO1xuXG5jb25zdCBFdmVudFNjaGVtYTogbW9uZ29vc2UuU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgTmFtZTogeyB0eXBlOiBTdHJpbmcsIHVuaXF1ZTogdHJ1ZSwgaW5kZXg6IHRydWUgfSxcbiAgICBFSUQ6IHsgdHlwZTogU3RyaW5nLCB1bmlxdWU6IHRydWUsIHNwYXJzZTogdHJ1ZSwgaW5kZXg6IHRydWV9LFxuICAgIERlc2NyaXB0aW9uOiB7IHR5cGU6IFN0cmluZyB9LFxuICAgIENvbnRlc3RhbnRzOiBbe3R5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiAnQ29udGVzdGFudCd9XSxcbiAgICBSb3VuZHM6IFtSb3VuZFNjaGVtYV0sXG4gICAgUGhvbmVOdW1iZXI6IFN0cmluZyxcbiAgICBSZWdpc3RyYXRpb25zOiBbeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1JlZ2lzdHJhdGlvbicgfV0sXG4gICAgQ3VycmVudFJvdW5kOiBSb3VuZFNjaGVtYSxcbiAgICBFbmFibGVkOiB7dHlwZTogQm9vbGVhbiwgaW5kZXg6IHRydWV9LFxuICAgIFJlZ2lzdHJhdGlvbkNvbmZpcm1hdGlvbk1lc3NhZ2U6IFN0cmluZyxcbiAgICBMb2dzOiBbe1xuICAgICAgICBNZXNzYWdlOiBTdHJpbmcsXG4gICAgICAgIENyZWF0ZWREYXRlOiBEYXRlXG4gICAgfV0sXG4gICAgUmVnaXN0cmF0aW9uc1ZvdGVGYWN0b3I6IFtSZWdpc3RyYXRpb25Wb3RlclNjaGVtYV0sXG4gICAgVm90ZUJ5TGluazogQm9vbGVhbixcbiAgICBTZW5kTGlua1RvR3Vlc3RzOiBCb29sZWFuLFxuICAgIEVtYWlsUmVnaXN0cmF0aW9uOiBCb29sZWFuLFxuICAgIENvdW50cnk6IHt0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ0NvdW50cnknIH0sXG4gICAgRXZlbnRTdGFydERhdGVUaW1lOiB7dHlwZTogRGF0ZSwgaW5kZXg6IHRydWV9LFxuICAgIEV2ZW50RW5kRGF0ZVRpbWU6IERhdGUsXG4gICAgVGltZVpvbmU6IHt0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ1RpbWV6b25lJyB9LFxuICAgIFRpbWVab25lT2Zmc2V0OiBTdHJpbmcsXG4gICAgVGltZVpvbmVJQ0FOTjogU3RyaW5nLFxuICAgIFRpY2tldExpbms6IFN0cmluZyxcbiAgICBQcmljZTogU3RyaW5nLFxuICAgIFZlbnVlOiBTdHJpbmcsXG4gICAgU2hvd0luQXBwOiB7IHR5cGU6IEJvb2xlYW4sIGluZGV4OiB0cnVlfSxcbiAgICBDdXJyZW5jeToge3R5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCwgcmVmOiAnQ291bnRyeScgfSxcbiAgICBBcnRXaWR0aEhlaWdodDogU3RyaW5nLFxuICAgIEF1Y3Rpb25EZXNjcmlwdGlvbjogU3RyaW5nLFxuICAgIEF1Y3Rpb25TdGFydEJpZDogTnVtYmVyLFxuICAgIE1pbkJpZEluY3JlbWVudDogTnVtYmVyLFxuICAgIEF1Y3Rpb25Ob3RpY2U6IFN0cmluZyxcbiAgICBFbmFibGVBdWN0aW9uOiBCb29sZWFuLFxuICAgIFRheDogTnVtYmVyLFxuICAgIEFkbWluQ29udHJvbEluQXVjdGlvblBhZ2U6IEJvb2xlYW4sXG4gICAgUmVnaXN0ZXJBdFNNU1ZvdGU6IEJvb2xlYW4sXG4gICAgU3BvbnNvckxvZ286IHt0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ01lZGlhJyB9LFxuICAgIFNwb25zb3JUZXh0OiBTdHJpbmcsXG4gICAgU2VuZEF1Y3Rpb25MaW5rVG9HdWVzdHM6IEJvb2xlYW4sXG4gICAgQ2l0eTogeyB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsIHJlZjogJ0NpdHknIH0sXG4gICAgU2xhY2tDaGFubmVsOiBTdHJpbmcsXG4gICAgQXVjdGlvbkNsb3NlU3RhcnRzQXQ6IERhdGUsXG4gICAgVmlkZW9TdHJlYW06IFN0cmluZyxcbiAgICBMaXZlU3RyZWFtOiBTdHJpbmcsXG4gICAgQXVjdGlvbkNsb3NlUm91bmREZWxheTogTnVtYmVyXG59LCB7IHRpbWVzdGFtcHM6IHRydWUgfSk7XG5cbkV2ZW50U2NoZW1hLm1ldGhvZHMuaGFzVm90ZWQgPSBmdW5jdGlvbihwaG9uZU51bWJlcjogc3RyaW5nLCBzZWxlY3RlZFJvdW5kPzogUm91bmREVE8pOiBSb3VuZENvbnRlc3RhbnREVE8gfCBib29sZWFuIHtcbiAgICBjb25zdCB0aGlzRXZlbnQgPSAoPEV2ZW50RG9jdW1lbnQ+dGhpcyk7XG4gICAgY29uc3QgY2hlY2tWb3RlZEluUm91bmQgPSAocm91bmQ6IFJvdW5kRFRPKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91bmQuQ29udGVzdGFudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRlc3RhbnQgPSByb3VuZC5Db250ZXN0YW50c1tpXTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29udGVzdGFudC5Wb3Rlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZvdGVyID0gY29udGVzdGFudC5Wb3Rlc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAodm90ZXIuUGhvbmVOdW1iZXIgPT09IHBob25lTnVtYmVyIHx8IHZvdGVyLkVtYWlsID09PSBwaG9uZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGVzdGFudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgaWYgKHNlbGVjdGVkUm91bmQpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrVm90ZWRJblJvdW5kKHNlbGVjdGVkUm91bmQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjaGVja1ZvdGVkSW5Sb3VuZCh0aGlzRXZlbnQuQ3VycmVudFJvdW5kKTtcbiAgICB9XG59O1xuXG5FdmVudFNjaGVtYS5tZXRob2RzLmVkaXQgPSBmdW5jdGlvbihkdG86IEV2ZW50RFRPKTogdm9pZCB7XG4gICAgY29uc3QgdGhpc0V2ZW50ID0gKDxFdmVudERvY3VtZW50PnRoaXMpO1xuICAgIGNvbnN0IGF1Y3Rpb25TdGFydFRpbWUgPSBwYXJzZUZyb21UaW1lWm9uZShkdG8uQXVjdGlvbkNsb3NlU3RhcnRzQXQudG9TdHJpbmcoKSwgJ00vRC9ZIEhIOm1tIEEnLCB7IHRpbWVab25lOiBkdG8uVGltZVpvbmVJQ0FOTiB9KTtcbiAgICBkdG8uQXVjdGlvbkNsb3NlU3RhcnRzQXQgPSBhdWN0aW9uU3RhcnRUaW1lO1xuICAgIHRoaXNFdmVudC5OYW1lID0gZHRvLk5hbWU7XG4gICAgdGhpc0V2ZW50LkVJRCA9IGR0by5FSUQ7XG4gICAgdGhpc0V2ZW50LkRlc2NyaXB0aW9uID0gZHRvLkRlc2NyaXB0aW9uO1xuICAgIHRoaXNFdmVudC5QaG9uZU51bWJlciA9IGR0by5QaG9uZU51bWJlciAmJiBkdG8uUGhvbmVOdW1iZXIudHJpbSgpOyAvLyBwaG9uZSBudW1iZXIgaXMgb3B0aW9uYWxcbiAgICB0aGlzRXZlbnQuQ29udGVzdGFudHMgPSBkdG8uQ29udGVzdGFudHM7XG4gICAgdGhpc0V2ZW50LkNvdW50cnkgPSBkdG8uQ291bnRyeTtcbiAgICB0aGlzRXZlbnQuRXZlbnRTdGFydERhdGVUaW1lID0gZHRvLkV2ZW50U3RhcnREYXRlVGltZTtcbiAgICB0aGlzRXZlbnQuQXVjdGlvbkNsb3NlU3RhcnRzQXQgPSBkdG8uQXVjdGlvbkNsb3NlU3RhcnRzQXQ7XG4gICAgdGhpc0V2ZW50LkV2ZW50RW5kRGF0ZVRpbWUgPSBkdG8uRXZlbnRFbmREYXRlVGltZTtcbiAgICB0aGlzRXZlbnQuVGltZVpvbmUgPSBkdG8uVGltZVpvbmU7XG4gICAgdGhpc0V2ZW50LlRpbWVab25lT2Zmc2V0ID0gZHRvLlRpbWVab25lT2Zmc2V0O1xuICAgIHRoaXNFdmVudC5SZWdpc3RyYXRpb25Db25maXJtYXRpb25NZXNzYWdlID0gZHRvLlJlZ2lzdHJhdGlvbkNvbmZpcm1hdGlvbk1lc3NhZ2U7XG4gICAgdGhpc0V2ZW50LkVuYWJsZWQgPSBkdG8uRW5hYmxlZDtcbiAgICB0aGlzRXZlbnQuVm90ZUJ5TGluayA9IGR0by5Wb3RlQnlMaW5rO1xuICAgIHRoaXNFdmVudC5TZW5kTGlua1RvR3Vlc3RzID0gZHRvLlNlbmRMaW5rVG9HdWVzdHM7XG4gICAgdGhpc0V2ZW50LkVtYWlsUmVnaXN0cmF0aW9uID0gZHRvLkVtYWlsUmVnaXN0cmF0aW9uO1xuICAgIHRoaXNFdmVudC5UaW1lWm9uZUlDQU5OID0gZHRvLlRpbWVab25lSUNBTk47XG4gICAgdGhpc0V2ZW50LlRpY2tldExpbmsgPSBkdG8uVGlja2V0TGluaztcbiAgICB0aGlzRXZlbnQuVmVudWUgPSBkdG8uVmVudWU7XG4gICAgdGhpc0V2ZW50LlByaWNlID0gZHRvLlByaWNlO1xuICAgIHRoaXNFdmVudC5TaG93SW5BcHAgPSBkdG8uU2hvd0luQXBwO1xuICAgIHRoaXNFdmVudC5DdXJyZW5jeSA9IGR0by5DdXJyZW5jeTtcbiAgICB0aGlzRXZlbnQuQXJ0V2lkdGhIZWlnaHQgPSBkdG8uQXJ0V2lkdGhIZWlnaHQ7XG4gICAgdGhpc0V2ZW50LkF1Y3Rpb25EZXNjcmlwdGlvbiA9IGR0by5BdWN0aW9uRGVzY3JpcHRpb247XG4gICAgdGhpc0V2ZW50LkF1Y3Rpb25TdGFydEJpZCA9IGR0by5BdWN0aW9uU3RhcnRCaWQ7XG4gICAgdGhpc0V2ZW50Lk1pbkJpZEluY3JlbWVudCA9IGR0by5NaW5CaWRJbmNyZW1lbnQ7XG4gICAgdGhpc0V2ZW50LkF1Y3Rpb25Ob3RpY2UgPSBkdG8uQXVjdGlvbk5vdGljZTtcbiAgICB0aGlzRXZlbnQuRW5hYmxlQXVjdGlvbiA9IGR0by5FbmFibGVBdWN0aW9uO1xuICAgIHRoaXNFdmVudC5BZG1pbkNvbnRyb2xJbkF1Y3Rpb25QYWdlID0gZHRvLkFkbWluQ29udHJvbEluQXVjdGlvblBhZ2U7XG4gICAgdGhpc0V2ZW50LlJlZ2lzdGVyQXRTTVNWb3RlID0gZHRvLlJlZ2lzdGVyQXRTTVNWb3RlO1xuICAgIHRoaXNFdmVudC5UYXggPSBkdG8uVGF4O1xuICAgIHRoaXNFdmVudC5TZW5kQXVjdGlvbkxpbmtUb0d1ZXN0cyA9IGR0by5TZW5kQXVjdGlvbkxpbmtUb0d1ZXN0cztcbiAgICB0aGlzRXZlbnQuU3BvbnNvclRleHQgPSBkdG8uU3BvbnNvclRleHQ7XG4gICAgdGhpc0V2ZW50LkxpdmVTdHJlYW0gPSBkdG8uTGl2ZVN0cmVhbTtcbiAgICB0aGlzRXZlbnQuVmlkZW9TdHJlYW0gPSBkdG8uVmlkZW9TdHJlYW07XG4gICAgdGhpc0V2ZW50LkF1Y3Rpb25DbG9zZVJvdW5kRGVsYXkgPSBkdG8uQXVjdGlvbkNsb3NlUm91bmREZWxheTtcbiAgICBpZiAoZHRvLlNwb25zb3JMb2dvKSB7XG4gICAgICAgIHRoaXNFdmVudC5TcG9uc29yTG9nbyA9IGR0by5TcG9uc29yTG9nbztcbiAgICB9XG4gICAgdGhpc0V2ZW50LkNpdHkgPSBkdG8uQ2l0eTtcbiAgICB0aGlzRXZlbnQuU2xhY2tDaGFubmVsID0gZHRvLlNsYWNrQ2hhbm5lbDtcblxuICAgIGNvbnN0IHJvdW5kSWRzID0gZHRvLlJvdW5kcy5tYXAociA9PiByLl9pZCk7XG4gICAgdGhpc0V2ZW50LlJvdW5kcyA9IHRoaXNFdmVudC5Sb3VuZHMuZmlsdGVyKHIgPT4gcm91bmRJZHMuY29udGFpbnMoKDxhbnk+cikuaWQpKTtcbiAgICB0aGlzRXZlbnQuUm91bmRzLmZvckVhY2gociA9PiB7XG4gICAgICAgIHIuQ29udGVzdGFudHMgPSB1cGRhdGVSb3VuZChkdG8sIHIpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgY3VycmVudFJvdW5kID0gdGhpc0V2ZW50LkN1cnJlbnRSb3VuZDtcbiAgICBpZiAoY3VycmVudFJvdW5kKSB7XG4gICAgICAgIGN1cnJlbnRSb3VuZC5Db250ZXN0YW50cyA9IHVwZGF0ZVJvdW5kKGR0bywgY3VycmVudFJvdW5kKTtcbiAgICB9XG5cbiAgICBjb25zdCBleGlzdGluZ0V2ZW50SWRzID0gdGhpc0V2ZW50LlJvdW5kcy5tYXAociA9PiAoPGFueT5yKS5pZCk7XG4gICAgY29uc3QgbmV3Um91bmRzID0gZHRvLlJvdW5kcy5maWx0ZXIocmR0byA9PiAhZXhpc3RpbmdFdmVudElkcy5jb250YWlucyhyZHRvLl9pZCkpO1xuICAgIHRoaXNFdmVudC5Sb3VuZHMuYWRkUmFuZ2UobmV3Um91bmRzKTtcbn07XG5cbmZ1bmN0aW9uIHVwZGF0ZVJvdW5kKGR0bzogRXZlbnREVE8sIHI6IFJvdW5kRFRPKSB7XG4gICAgY29uc3Qgcm91bmREdG8gPSBkdG8uUm91bmRzLmZpbmQoeCA9PiB4Ll9pZCA9PSAoPGFueT5yKS5pZCk7IC8vIG5ld1xuICAgIC8vIGFkZCB2aWRlbyBVUkwgaW4gcm91bmRcbiAgICByLlZpZGVvVXJsID0gcm91bmREdG8uVmlkZW9Vcmw7XG4gICAgY29uc3QgbmV3Q29udGVzdGFudE1hcDoge1trZXk6IHN0cmluZ106IFJvdW5kQ29udGVzdGFudERUT30gPSB7fTtcbiAgICBjb25zdCBvbGRDb250ZXN0YW50TWFwOiB7W2tleTogc3RyaW5nXTogUm91bmRDb250ZXN0YW50RFRPfSA9IHt9O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91bmREdG8uQ29udGVzdGFudHMubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgIC8vIGl0ZXJhdGUgb24gbmV3IGNvbnRlc3RhbnRzXG4gICAgICAgIG5ld0NvbnRlc3RhbnRNYXBbcm91bmREdG8uQ29udGVzdGFudHNbaV0uRGV0YWlsLl9pZC50b1N0cmluZygpXSA9IHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldO1xuICAgIH1cbiAgICBjb25zdCB0b1JlbW92ZUV4aXN0aW5nSW5kZXhlczogbnVtYmVyW10gPSBbXTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHIuQ29udGVzdGFudHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgLy8gaXRlcmF0ZSBvbiBvbGQgY29udGVzdGFudFxuICAgICAgICBvbGRDb250ZXN0YW50TWFwW3IuQ29udGVzdGFudHNbal0uRGV0YWlsLl9pZC50b1N0cmluZygpXSA9IHIuQ29udGVzdGFudHNbal07XG4gICAgICAgIGNvbnN0IGNvbnRlc3RhbnREdG8gPSBuZXdDb250ZXN0YW50TWFwW3IuQ29udGVzdGFudHNbal0uRGV0YWlsLl9pZC50b1N0cmluZygpXTtcbiAgICAgICAgaWYgKGNvbnRlc3RhbnREdG8pIHtcbiAgICAgICAgICAgIC8vIGFzc2lnbiBuZXcgZWFzZWwgbnVtYmVyIHRvIGV4aXN0aW5nXG4gICAgICAgICAgICByLkNvbnRlc3RhbnRzW2pdLkVhc2VsTnVtYmVyID0gY29udGVzdGFudER0by5FYXNlbE51bWJlcjtcbiAgICAgICAgICAgIC8vIGFzc2lnbiBuZXcgZW5hYmxlL2Rpc2FibGUgc3RhdHVzIHRvIGV4aXN0aW5nXG4gICAgICAgICAgICByLkNvbnRlc3RhbnRzW2pdLkVuYWJsZWQgPSBjb250ZXN0YW50RHRvLkVuYWJsZWQ7XG4gICAgICAgICAgICAvLyBhc3NpZ24gTG90XG4gICAgICAgICAgICByLkNvbnRlc3RhbnRzW2pdLkxvdCA9IGNvbnRlc3RhbnREdG8uTG90O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gdGhlc2UgZWxlbWVudHMgcmVtb3ZlZC9yZXBsYWNlZCBpbiBuZXcgdXBkYXRlXG4gICAgICAgICAgICB0b1JlbW92ZUV4aXN0aW5nSW5kZXhlcy5wdXNoKGopO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdG9SZW1vdmVOZXdJbmRleGVzOiBudW1iZXJbXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91bmREdG8uQ29udGVzdGFudHMubGVuZ3RoOyBpKysgKSB7XG4gICAgICAgIC8vIGl0ZXJhdGUgb24gbmV3IGNvbnRlc3RhbnRzXG4gICAgICAgIGlmIChyb3VuZER0by5Db250ZXN0YW50c1tpXS5EZXRhaWwub2xkSWQgJiYgcm91bmREdG8uQ29udGVzdGFudHNbaV0uRGV0YWlsLm9sZElkLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICYmIG9sZENvbnRlc3RhbnRNYXBbcm91bmREdG8uQ29udGVzdGFudHNbaV0uRGV0YWlsLm9sZElkLnRvU3RyaW5nKCldXG4gICAgICAgICkge1xuICAgICAgICAgICAgY29uc3Qgb2xkQ29udGVzdGFudCA9IG9sZENvbnRlc3RhbnRNYXBbcm91bmREdG8uQ29udGVzdGFudHNbaV0uRGV0YWlsLm9sZElkLnRvU3RyaW5nKCldO1xuICAgICAgICAgICAgLy8gY29weSBkYXRhIG9mIG9sZCBjb250ZXN0YW50IGhlcmVcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLkVhc2VsTnVtYmVyID0gb2xkQ29udGVzdGFudC5FYXNlbE51bWJlcjtcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLkVuYWJsZUF1Y3Rpb24gPSBvbGRDb250ZXN0YW50LkVuYWJsZUF1Y3Rpb247XG4gICAgICAgICAgICByb3VuZER0by5Db250ZXN0YW50c1tpXS5Jc1dpbm5lciA9IG9sZENvbnRlc3RhbnQuSXNXaW5uZXI7XG4gICAgICAgICAgICByb3VuZER0by5Db250ZXN0YW50c1tpXS5MYXN0QmlkUHJpY2UgPSBvbGRDb250ZXN0YW50Lkxhc3RCaWRQcmljZTtcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLlZvdGVzID0gb2xkQ29udGVzdGFudC5Wb3RlcztcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLlZvdGVzRGV0YWlsID0gb2xkQ29udGVzdGFudC5Wb3Rlc0RldGFpbDtcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLkltYWdlcyA9IG9sZENvbnRlc3RhbnQuSW1hZ2VzO1xuICAgICAgICAgICAgcm91bmREdG8uQ29udGVzdGFudHNbaV0uVmlkZW9zID0gb2xkQ29udGVzdGFudC5WaWRlb3M7XG4gICAgICAgICAgICByb3VuZER0by5Db250ZXN0YW50c1tpXS5Mb3QgPSBvbGRDb250ZXN0YW50LkxvdDtcbiAgICAgICAgICAgIHJvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLlJlZ2lzdHJhdGlvbiA9IG9sZENvbnRlc3RhbnQuUmVnaXN0cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvbGRDb250ZXN0YW50TWFwW3JvdW5kRHRvLkNvbnRlc3RhbnRzW2ldLkRldGFpbC5faWQudG9TdHJpbmcoKV0pIHtcbiAgICAgICAgICAgIC8vIHRoaXMgY29udGVzdGFudCBhbHJlYWR5IGV4aXN0cyBpbiBhcnJheSwgbm8gbmVlZCB0byBhZGQgYWdhaW5cbiAgICAgICAgICAgIHRvUmVtb3ZlTmV3SW5kZXhlcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGZpbHRlciBleGlzdGluZyBjb250ZXN0YW50c1xuICAgIHIuQ29udGVzdGFudHMgPSByLkNvbnRlc3RhbnRzLmZpbHRlcigoYywgaW5kZXgpID0+IHtyZXR1cm4gdG9SZW1vdmVFeGlzdGluZ0luZGV4ZXMuaW5kZXhPZihpbmRleCkgPT09IC0xOyB9KTtcbiAgICAvLyBmaWx0ZXIgbmV3IGNvbnRlc3RhbnRzXG4gICAgY29uc3QgbmV3Q29udGVzdGFudHMgPSByb3VuZER0by5Db250ZXN0YW50cy5maWx0ZXIoKGMsIGluZGV4KSA9PiB7cmV0dXJuIHRvUmVtb3ZlTmV3SW5kZXhlcy5pbmRleE9mKGluZGV4KSA9PT0gLTE7IH0pO1xuICAgIC8vIGFkZCBuZXcgY29udGVzdGFudHNcbiAgICByLkNvbnRlc3RhbnRzLmFkZFJhbmdlKG5ld0NvbnRlc3RhbnRzKTtcbiAgICByZXR1cm4gci5Db250ZXN0YW50cztcbn1cblxuY29uc3QgRXZlbnRNb2RlbCA9IG1vbmdvb3NlLm1vZGVsPEV2ZW50RG9jdW1lbnQ+KCdFdmVudCcsIEV2ZW50U2NoZW1hKTtcbmV4cG9ydCBkZWZhdWx0IEV2ZW50TW9kZWw7Il19
